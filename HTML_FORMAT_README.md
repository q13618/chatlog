# HTML格式聊天记录功能

## 概述

为聊天记录API添加了HTML格式支持，提供更好的用户体验和媒体内容预览功能。

## 新功能特性

### 1. HTML格式支持
- 在`GET /api/v1/chatlog` API中添加了`format=html`参数支持
- 返回格式化的HTML页面，包含完整的样式和交互功能

### 2. 悬停预览功能
- **语音消息**: 悬停在`[语音]`上可以预览并播放语音
- **图片消息**: 悬停在`![图片]`上可以预览图片
- **视频消息**: 悬停在`![视频]`上可以预览视频
- **文件消息**: 悬停在`[文件]`上可以下载文件

### 3. 响应式设计
- 预览内容采用绝对定位，不会影响页面布局
- 支持移动设备和桌面设备
- 优雅的悬停效果和过渡动画

## 使用方法

### API调用
```bash
# 获取HTML格式的聊天记录
GET /api/v1/chatlog?time=2023-01-01&talker=wxid_xxx&format=html

# 参数说明
time: 时间范围（必填）
talker: 聊天对象（必填）
format: 输出格式，支持 txt、json、csv、html
```

### Web界面
1. 在Web界面中选择"聊天记录"或"聊天记录(测试)"标签
2. 填写查询参数
3. 在"输出格式"下拉菜单中选择"HTML"
4. 点击"测试API"按钮
5. 结果将以HTML格式显示，支持悬停预览

## 技术实现

### 后端实现
- 在`internal/model/message.go`中添加了`HTML()`和`HTMLContent()`方法
- 在`internal/chatlog/http/route.go`中添加了HTML格式处理逻辑
- 支持所有消息类型的HTML渲染

### 前端实现
- 在Web界面中添加了HTML格式选项
- 更新了JavaScript代码以正确处理HTML响应
- 实现了悬停预览的交互逻辑

### 媒体预览
- 图片: 使用`<img>`标签显示
- 语音: 使用`<audio>`标签播放
- 视频: 使用`<video>`标签播放
- 文件: 提供下载链接

## 示例输出

### 文本格式
```
小雪(陈建霖妈妈)(AA523086) 08-25 22:24:41
[语音](http://127.0.0.1:5030/voice/2770686711445571857)
```

### HTML格式
```html
小雪(陈建霖妈妈)(AA523086) 08-25 22:24:41<br/>
<span class="media-preview" data-type="voice" data-url="http://127.0.0.1:5030/voice/2770686711445571857">[语音]</span><br/>
```

## 兼容性

- 完全向后兼容，不影响现有的txt、json、csv格式
- 支持所有微信版本（v3、v4、Darwin v3）
- 支持所有消息类型和子类型

## 注意事项

1. HTML格式会返回完整的HTML页面，包含样式和脚本
2. 媒体预览需要网络连接以加载媒体文件
3. 预览内容采用绝对定位，在某些复杂布局中可能需要调整
4. 建议在现代浏览器中使用以获得最佳体验

## 未来改进

- 支持更多媒体类型的预览
- 添加缩略图支持
- 优化移动设备体验
- 支持自定义样式主题
